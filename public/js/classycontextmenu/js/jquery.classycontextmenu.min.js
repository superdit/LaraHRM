/*!
 * jQuery ClassyContextMenu
 * www.class.pm
 *
 * Written by Marius Stanciu - Sergiu <marius@class.pm>
 * Licensed under the MIT license www.class.pm/LICENSE-MIT
 * Version 1.5.0
 *
 */
 (function(a){var m={menu:null,mouseButton:"right",isMenu:!0,minWidth:120,maxWidth:0,delay:500,keyboard:!0,hoverIntent:!0,onSelect:function(a){},onLoad:function(){},onShow:function(){},onHide:function(){}},h=[],g={init:function(b){b=a.extend({},m,b);if(!b.menu)return!1;var c;"object"!==typeof b.menu||null===b.menu.constructor.toString().match(/array/i)&&!b.menu.length?(c=a(document.getElementById(b.menu)),c.data("ClassyContextMenuDynamic",!1),c.data("ClassyContextMenuOriginal",c.clone())):(c=a("<div/>").append(l(b.menu)), a("body").append(c),c.data("ClassyContextMenuDynamic",!0));return this.each(function(){var e=a(this),d;e.data("ClassyContextMenu")||(d="ClassyContextMenuContext-"+(new Date).getTime(),e.data("ClassyContextMenuEventNamespace",d).data("ClassyContextMenuOptions",b).data("ClassyContextMenu",c).data("ClassyContextMenuEnable",!0),c.data("isMenu",b.isMenu),c.data("ClassyContextMenuOwners")||c.data("ClassyContextMenuOwners",[]),c.data("ClassyContextMenuOwners").push(e),h.push(c),b.isMenu?g.refresh.call(e): (c.hide(),c.css({position:"absolute","z-index":99999})),e.bind(("right"===b.mouseButton?"contextmenu":"click")+"."+d,function(f){if(!e.data("ClassyContextMenuEnable"))return!0;g.show.apply(e,[f.pageX,f.pageY,b.showAnimation]);b.isMenu&&b.keyboard?a(window).bind("keydown."+d,function(b){switch(event.keyCode){case 27:a(document).trigger("click."+d);break;case 40:return 0===c.find("li.hover").length?c.find("li:not(.disabled):first").addClass("hover"):(b=c.find("li.hover:last"),b.parent().find("li.hover").removeClass("hover").nextAll("li:not(.disabled)").eq(0).addClass("hover"), 0===b.parent().find("li.hover").length&&b.parent().find("li:not(.disabled):first").addClass("hover")),!1;case 38:return 0===c.find("li.hover").length?c.find("li:not(.disabled):first").nextAll().eq(-1).addClass("hover"):(b=c.find("li.hover:last"),b.parent().find("li.hover").removeClass("hover").prevAll("li:not(.disabled)").eq(0).addClass("hover"),0===b.parent().find("li.hover").length&&b.parent().find("li:first").nextAll().eq(-1).addClass("hover")),!1;case 39:return 0<c.find("li.hover ul").length&& (c.find("li.hover:last").find("ul:first").show().offset(k({top:c.find("li.hover:last").offset().top},c.find("li.hover:last").find("ul:first"))),c.find("li.hover:last ul:first li:not(.disabled):first").addClass("hover")),!1;case 37:return c.find("li.hover:last").parent().parent().hasClass("ClassyContextMenu")||c.find("li.hover:last").removeClass("hover").parent().hide(),!1}return!0}):b.keyboard&&a(window).bind("keydown."+d,function(b){27===event.keyCode&&a(document).trigger("click."+d)});a("li",c).each(function(){a(this).click(function(){a(this).hasClass("disabled")|| b.onSelect.call(this,{id:a(this).attr("id"),action:a("a:first",this).attr("href").substr(1)})})});a(document).bind("click."+d,function(b){a(window).unbind("keydown."+d);a(document).unbind("click."+d);a("li",c).unbind("click");g.hide.call()});b.onShow.call(this);return!1}));b.onLoad.call(this)})},refresh:function(b){var c;return this.each(function(){var e=a(this),d=e.data("ClassyContextMenu"),f,g;e.data("ClassyContextMenu").data("isMenu")&&(c=a.extend(e.data("ClassyContextMenuOptions"),b),c.hoverIntent&& !a.fn.hoverIntent&&(c.hoverIntent=!1),d.removeClass("ClassyContextMenu"),a("li",d).removeClass("hover"),a("span",d).remove(),d.addClass("ClassyContextMenu"),g=a("<div/>").addClass("ClassyContextMenu").appendTo("body"),a("ul",d).each(function(){g.html("");f=0;g.html(a(this).html());f=g.width()+16;f<c.minWidth&&(f=c.minWidth);f>c.maxWidth&&0<c.maxWidth&&(f=c.maxWidth);a(this).width(f);a(this).children("li").children("ul").css("left",f)}),g.remove(),a("li:has(ul)",d).each(function(){a(this).hasClass("disabled")|| (a("a:first",this).append(a("<span/>")),c.hoverIntent?a(this).hoverIntent({over:function(){a("ul:first",this).show().offset(k({top:a(this).offset().top},a("ul:first",this)))},out:function(){a("ul:first",this).hide()},timeout:c.delay}):a(this).hover(function(){a("ul:first",this).show().offset(k({top:a(this).offset().top},a(this).find("ul:first")))},function(){a("ul:first",this).hide()}))}),a("li",d).each(function(){a(this).click(function(){1>a("ul",this).length&&(a("li",d).unbind("click"),d.hide()); return!1});a(this).hover(function(){a(this).parent().find("li.hover").removeClass("hover");a(this).addClass("hover")},function(){a(this).removeClass("hover")})}))})},restore:function(){return this.each(function(){var b=a(this),c=b.data("ClassyContextMenu");b.unbind("."+b.data("ClassyContextMenuEventNamespace"));a(window).unbind("keydown."+b.data("ClassyContextMenuEventNamespace"));a(document).unbind("click."+b.data("ClassyContextMenuEventNamespace"));a.each(c.data("ClassyContextMenuOwners"),function(a){b[0]=== this&&c.data("ClassyContextMenuOwners").splice(a,1)});1>c.data("ClassyContextMenuOwners").length&&(a.each(h,function(a){c[0]===this&&h.splice(a,1)}),c.data("ClassyContextMenuDynamic")?c.remove():(c.removeClass("ClassyContextMenu"),c.replaceWith(c.data("ClassyContextMenuOriginal"))));b.removeData("ClassyContextMenuEventNamespace");b.removeData("ClassyContextMenu");b.removeData("ClassyContextMenuOptions");b.removeData("ClassyContextMenuEnable")})},show:function(b,c){if(!b||!c)return!1;var e=a(this).first().data("ClassyContextMenu"); g.hide.apply(this);e.show();e.data("ClassyContextMenu",a(this));e.offset(k({top:c,left:b},e,!0));return this},hide:function(){a.each(h,function(){a(".hover",this).removeClass("hover");a("ul:first ul",this).hide();a(this).data("ClassyContextMenu")&&(a(this).data("ClassyContextMenu").data("ClassyContextMenuOptions").onHide.call(a(this).data("ClassyContextMenu")),a(this).removeData("ClassyContextMenu"));a(this).hide()});return this},disable:function(b){if(b){var c=a(this).data("ClassyContextMenu");"#"=== b.charAt(0)?a("li"+b.replace(/ /g,"_"),c).addClass("disabled"):a('a[href="'+b+'"]',c).parent().addClass("disabled")}else a(this).data("ClassyContextMenuEnable",!1);return this},enable:function(b){if(b){var c=a(this).data("ClassyContextMenu");"#"===b.charAt(0)?a("li"+b.replace(/ /g,"_"),c).removeClass("disabled"):a('a[href="'+b+'"]',c).parent().removeClass("disabled")}else a(this).data("ClassyContextMenuEnable",!0),a("li",this).each(function(){a(this).removeClass("disabled")});return this}},k=function(b, c,e){b.top&&(b.top+c.height()-a(window).scrollTop()>a(window).height()&&(b.top=e?b.top-c.height():a(window).height()+a(window).scrollTop()-c.height()),b.top<a(window).scrollTop()&&(b.top=a(window).scrollTop()));b.left&&(b.left+c.width()-a(window).scrollLeft()>a(window).width()&&(b.left=a(window).width()-c.width()+a(window).scrollLeft()),b.left<a(window).scrollLeft()&&(b.left=a(window).scrollLeft()));return b},l=function(b){var c=a("<ul/>"),e,d,f;if(b)for(e in b)d=b[e],f=a("<li/>").attr("id",d.id.replace(/ /g, "_")).append(a("<a/>").attr("href",d.action?"#"+d.action:"#").text(d.text)),d.image&&f.prepend(a("<img/>").attr("src",d.image)),d.separator&&f.addClass("separator"),c.append(f),d.children&&f.append(l(d.children));return c};a.fn.ClassyContextMenu=function(a){return g[a]?g[a].apply(this,Array.prototype.slice.call(arguments,1)):"object"!==typeof a&&a?this:g.init.apply(this,arguments)}})(jQuery);